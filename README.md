Публикую свою старую наработку бота пользователя ВКонтакте.

# Установка
Для работы бота необходим php хостинг с версией не менее чем 7.2 и поддержкой curl и cron. Скачайте исходный код с репозитория и розархивируйте его в директорию вашего сайта. Далее нужно выполнить установку зависимостей:

```
composer install
```

Выполняем настройку:
1. Нужен ключ доступа к аккаунту с правами: просмотр сообщений, доступ к данным профиля. Его можно получить например [здесь](https://vkhost.github.io/). Выберите приложение с нужными правами, войдите на нужную страницу и нажмите разрешить доступ. После скопируйте ключ из адресной строки, который находится между "access_token=" и "&". Ключ даст доступ к данным страницы и программа сможет с ними работать.
2. Нужна база данных mysql. Создайте ее в панели управления хостинга.

Эти данные нужно ввести в файле inc/classes/config.php.


# Запуск
Соц. сеть не предоставляет нормального api для потоковой обработки сообщений пользователя. Приходиться костылить.

Программа работает с помощью файла system/server.php. Его можно запустить вручную, переходом на него или запускать автоматически с помощью cron задачи на хостинге. При запуске файл работает опредленное время, которое указано в цикле, в секундах. Его можно подобрать, либо оставить как сейчас (по тестам на моем хостинге - 4-5 минут, затем следует ошибка 504). Цикл получает непрочитанные диалоги, обрабатывает последнее сообщение и отвечает.

В среднем на один ответ уходит около 5 секунд. Таймаут сделан для обхода капчи и флуд контроля.

Если нет поддержки cron, есть вариант использовать ajax запроосы и setInterval(), но такое решение требует постоянного взаимодействия с сайтом.


# Админка
Доступна простейшая админка, которая позволяет просмотреть ответы бота и задать их. Разворачивается на сайте, где и сам бот.


# Ответы
Словарный запас бота храниться в базе данных, им можно управлять админке.

Разберём поля:
- Вопрос - фраза по которой происходит проверка на совпадение с принятым сообщением.
- Ответ - фраза, соответствующий ответ на вопрос.
- Приоритет - цифра, показывает приоритет ответа среди других похожих. Чем больше цифра, тем больше шанс, что программа выберет именно этот ответ . Диапазон от 1 до 5.

## Пакетное добавление
Помимо ручного добавления, можно импортировать ответы одним файлом, который должен содержать строки по формуле:

```
вопрос\ответ\приоритет
```

Важно, чтобы разделителем был именно "\". Пример содержимого файла:

```
Йоу\Привет\3
Как дела?\Хорошо,а у тебя\2
```

Разрешенные форматы .txt и .bin

## Специальные ответы
Некоторые ответы, которые напрямую записаны в код:
1. Инфа, что %любой текст% - ответ: Инфа %0 - 100% процентов
2. %любой текст% или %любой текст% - бот выберет один из вариант и ответит им


# Защитим вход в админку.
Рекомендуется установить пароль на админ панель. Для этого нужно записать его в соответствующую строку в inc/classes/config.php.

# Живой пример
Размещен на heroku, живой [пример](https://vk.com/carl_111111).
